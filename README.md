–ù–∏–∂–µ ‚Äî **–ø–æ–ª–Ω—ã–π —Ä–∞–±–æ—á–∏–π —Å–∫—Ä–∏–ø—Ç** (Python 3 / pandas), –∫–æ—Ç–æ—Ä—ã–π:

1. **—á–∏—Ç–∞–µ—Ç** –≤—Å–µ –≤—Ö–æ–¥–Ω—ã–µ Excel-—Ñ–∞–π–ª—ã;  
2. —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç ¬´—Ç–æ–ª—Å—Ç—É—é¬ª –Ω–µ–¥–µ–ª—å–Ω—É—é –ø–∞–Ω–µ–ª—å **`weekly_panel_dt`**;  
3. **–¥–æ–±–∞–≤–ª—è–µ—Ç**  
   * —Å—Ä–µ–¥–Ω—é—é –∫–ª—é—á–µ–≤—É—é —Å—Ç–∞–≤–∫—É –∑–∞ –Ω–µ–¥–µ–ª—é (`key_rate_wavg`),  
   * dummy `kr_change` ‚Äî –±—ã–ª–æ –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ö–° –≤–Ω—É—Ç—Ä–∏ –Ω–µ–¥–µ–ª–∏,  
   * —Ñ–∞–∑–æ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã, —Å–µ–∑–æ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏, –ª–∞–≥–∏, –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ ¬´–Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞¬ª;  
4. **—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç** —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ï–î–ò–ù–°–¢–í–ï–ù–ù–û –≤ `weekly_panel_dt.xlsx`  
   (–æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–∏—Å—Ç, –±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö parquet / pickle).

> **–§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –ª–µ–∂–∞—Ç—å —Ä—è–¥–æ–º —Å —Å–∫—Ä–∏–ø—Ç–æ–º**  
> ‚Äì `weekly_dt.xlsx` ‚Äì –≤–∞—à–∞ —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–∏—Ç–æ–∫–æ–≤/–ø—Ä–µ–º–∏–π (—Å–∫—Ä–∏–Ω 3).  
> ‚Äì `key_rate.xlsx`   ‚Äì –ª–∏—Å—Ç —Å–æ —Å—Ç–æ–ª–±—Ü–∞–º–∏ **date | KR** (—Å–∫—Ä–∏–Ω 1).  
> ‚Äì `kc_events.xlsx` ‚Äì –ª–∏—Å—Ç —Å–æ —Å—Ç–æ–ª–±—Ü–æ–º **DATE** ‚Äì –¥–∞—Ç—ã –∑–∞—Å–µ–¥–∞–Ω–∏–π –¶–ë (—Å–∫—Ä–∏–Ω 2).  
> ‚Äì `clients.xlsx`   ‚Äì –ª–∏—Å—Ç **dt_rep | clients** (–º–µ—Å—è—á–Ω—ã–µ –∏–ª–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ).

```python
# =============================================================
#  0. –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
# =============================================================
import pandas as pd
import numpy as np
from pathlib import Path

# --- —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Ä–∞–∑—Ä—ã–≤—ã ----------------------------------------------------
BREAK_1 = pd.Timestamp('2024-05-15')
BREAK_2 = pd.Timestamp('2024-08-28')
BREAK_3 = pd.Timestamp('2025-02-19')

DATA = Path('.')                       # —Ä–∞–±–æ—á–∞—è –ø–∞–ø–∫–∞ —Å Excel-–∞–º–∏

# =============================================================
#  1. weekly_dt : saldo + –ø—Ä–µ–º–∏–∏  (–≥–æ—Ç–æ–≤—ã–π —Ñ–∞–π–ª Excel)
# =============================================================
weekly_dt = (pd.read_excel(DATA/'weekly_dt.xlsx',  parse_dates=['dt_rep'])
               .set_index('dt_rep')                # –∏–Ω–¥–µ–∫—Å = –∫–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏
               .sort_index())                     # –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –ø–æ—Ä—è–¥–æ–∫

# =============================================================
#  2. —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –∫–ª—é—á–µ–≤–∞—è —Å—Ç–∞–≤–∫–∞ (daily)  key_rate.xlsx
# =============================================================
kr = (pd.read_excel(DATA/'key_rate.xlsx', parse_dates=['date'])
        .rename(columns={'date':'Date', 'KR':'KR_%'}))

kr['key_rate'] = (kr['KR_%'].astype(str)
                               .str.replace(',', '.')
                               .str.rstrip('%')
                               .astype(float)
                               .div(100))              # –≤ –¥–æ–ª—è—Ö

kr = (kr[['Date','key_rate']]
        .set_index('Date')
        .sort_index())

# --- —Å—Ä–µ–¥–Ω—è—è –ö–° –∑–∞ –Ω–µ–¥–µ–ª—é (Thu-Wed) –∏ —Ñ–ª–∞–≥ –∏–∑–º–µ–Ω–µ–Ω–∏—è ------------------------
#   ‚ë† —Å—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω–∞—è = –ø—Ä–æ—Å—Ç–æ —Å—Ä–µ–¥–Ω—è—è daily
#   ‚ë° –∏–∑–º–µ–Ω–µ–Ω–∏–µ       = 1, –µ—Å–ª–∏ –∑–∞ –Ω–µ–¥–µ–ª—é –±—ã–ª –•–û–¢–¨ –û–î–ò–ù —Å–¥–≤–∏–≥ —Å—Ç–∞–≤–∫–∏
kr_w = (kr.resample('W-THU')
          .agg(key_rate_wavg = ('key_rate','mean'),
               kr_change     = ('key_rate', lambda s: int(s.nunique()>1)))
          .rename_axis('dt_rep'))

# =============================================================
#  3. –∫–∞–ª–µ–Ω–¥–∞—Ä—å –∑–∞—Å–µ–¥–∞–Ω–∏–π –¶–ë (kc_events.xlsx)
#     –Ω—É–∂–µ–Ω –¥–ª—è Diff-in-Diff üëâ —Å–æ–∑–¥–∞—ë–º dummy ¬´–ø–æ—Å–ª–µ —Å–æ–±—ã—Ç–∏—è¬ª
# =============================================================
ev_dates = (pd.read_excel(DATA/'kc_events.xlsx', parse_dates=['DATE'])
              .sort_values('DATE')['DATE']         # Series
              .dt.normalize())                     # —Ç–æ–ª—å–∫–æ –¥–∞—Ç–∞

# –¥–æ–±–∞–≤–∏–º –≤ kr_w —Å—Ç–æ–ª–±—Ü—ã post_<date>
for d in ev_dates:
    kr_w[f'post_{d.strftime("%d%b%y")}'] = (kr_w.index >= d).astype(int)

# =============================================================
#  4. –∫–ª–∏–µ–Ω—Ç—ã  clients.xlsx (¬´dt_rep | clients¬ª)
#     ‚Äì –µ—Å–ª–∏ –¥–∞—Ç—ã –º–µ—Å—è—á–Ω—ã–µ ‚Üí ffill –¥–æ daily ‚Üí weekly mean
# =============================================================
clients = (pd.read_excel(DATA/'clients.xlsx', parse_dates=['dt_rep'])
             .dropna(subset=['clients'])
             .set_index('dt_rep')
             .sort_index())

c_daily  = clients.asfreq('D').ffill()             # –µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–∫–ª–∞–¥–∫–∞
c_weekly = (c_daily
              .resample('W-THU')
              .mean()
              .rename_axis('dt_rep')
              .rename(columns={'clients':'clients_mean'}))

# =============================================================
#  5. SCHEMA MERGE  ‚Üí weekly_panel_dt
# =============================================================
panel = (weekly_dt
           .join([kr_w, c_weekly], how='left')
           .sort_index())

# --- —Ñ–∞–∑–æ–≤—ã–µ –¥–∞–º–º–∏ -------------------------------------------
panel['phase_II']  = ((panel.index >= BREAK_2) & (panel.index < BREAK_3)).astype(int)
panel['phase_III'] =  (panel.index >= BREAK_3).astype(int)

# --- —Ä—É—á–Ω–∞—è —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å: –Ω–µ–¥–µ–ª—è –≤–Ω—É—Ç—Ä–∏ –º–µ—Å—è—Ü–∞ / ¬´–∑–∞—Ä–ø–ª–∞—Ç–Ω–∞—è¬ª ---
panel['week_of_month'] = panel.index.day.sub(1).floordiv(7).add(1)
panel['salary_week']   = (panel['week_of_month'] == 3).astype(int)

# --- –ª–∞–≥–∏ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π (p=4, q=0‚Ä¶3) ---------------
for lag in range(1,5):                                   # p = 4
    panel[f'saldo_lag{lag}'] = panel['saldo'].shift(lag)

for lag in range(4):                                     # q = 0‚Ä¶3
    for col in ['prm_90','prm_max1Y']:
        panel[f'{col}_lag{lag}'] = panel[col].shift(lag)

# --- ¬´–Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞¬ª --------------------------------------------
for col in ['saldo','prm_90','prm_max1Y']:
    panel[f'{col}_pc'] = panel[col] / panel['clients_mean']

# =============================================================
#  6. SAVE ‚ñ∂ Excel (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ–∞–π–ª)
# =============================================================
out_file = DATA/'weekly_panel_dt.xlsx'
with pd.ExcelWriter(out_file, engine='xlsxwriter') as xl:
    panel.to_excel(xl, sheet_name='panel', index=True)

print('‚úì weekly_panel_dt.xlsx —Å–æ–∑–¥–∞–Ω :', len(panel), '—Å—Ç—Ä–æ–∫')
```

### –ß—Ç–æ —Ç–µ–ø–µ—Ä—å –ª–µ–∂–∏—Ç –≤ `weekly_panel_dt.xlsx ‚Üí –ª–∏—Å—Ç panel`

| –∫–æ–ª–æ–Ω–∫–∞                          | –∑–∞—á–µ–º –º–æ–¥–µ–ª–µ–π |
|----------------------------------|---------------|
| `saldo` / `prm_90` / `prm_max1Y` | –±–∞–∑–æ–≤—ã–µ —Ä—è–¥—ã |
| `key_rate_wavg`                  | **—Å—Ä–µ–¥–Ω—è—è** –∫–ª—é—á–µ–≤–∞—è —Å—Ç–∞–≤–∫–∞ –∑–∞ –Ω–µ–¥–µ–ª—é |
| `kr_change` (0/1)                | –±—ã–ª–æ –ª–∏ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ö–° –≤ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ |
| `post_<date>`                    | –î–∞–º–º–∏ –¥–ª—è event-study / Diff-in-Diff |
| `phase_II`, `phase_III`          | –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ –∞–≤–≥—É—Å—Ç-24 –∏ —Ñ–µ–≤—Ä–∞–ª—å-25 |
| `week_of_month`, `salary_week`   | —Ä—É—á–Ω–∞—è –Ω–µ–¥–µ–ª—å–Ω–∞—è —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å |
| –õ–∞–≥–∏ `saldo_lag*`, `prm*_lag*`   | ARDL / –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è OLS |
| `*_pc`                           | –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ ¬´–Ω–∞ –æ–¥–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞¬ª |

–§–∞–π–ª Excel ‚Äî –æ–¥–Ω–∞ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è **OLS, ARDL, SARIMAX** –∏ event-–∞–Ω–∞–ª–∏–∑–∞.
