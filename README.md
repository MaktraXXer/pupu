WITH ranked_in AS (
    SELECT
        WEEK_START,
        WEEK,
        INCOMING_BANK_NAME,
        INCOMING_SUM_TRANS,
        ROW_NUMBER() OVER (
            PARTITION BY WEEK_START, WEEK
            ORDER BY INCOMING_SUM_TRANS DESC
        ) AS rn
    FROM sbp_statistic
)
SELECT
    WEEK_START,
    WEEK,
    INCOMING_BANK_NAME,
    INCOMING_SUM_TRANS
FROM ranked_in
WHERE rn <= 5
UNION ALL
SELECT
    WEEK_START,
    WEEK,
    'ОСТАЛЬНЫЕ_БАНКИ' AS INCOMING_BANK_NAME,
    SUM(INCOMING_SUM_TRANS) AS INCOMING_SUM_TRANS
FROM ranked_in
WHERE rn > 5
GROUP BY WEEK_START, WEEK
ORDER BY WEEK_START, WEEK, INCOMING_BANK_NAME;
