```python
# -*- coding: utf-8 -*-
"""
–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ Excel ‚Üí —Ä–∞—Å—á—ë—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –ø—Ä–æ–ª–æ–Ω–≥–∞—Ü–∏–∏.

1) –°—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª Excel.
2) –î–æ–±–∞–≤–∏—Ç—å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è ¬´‚Ä¶ —Å %¬ª.
3) –î–æ–±–∞–≤–∏—Ç—å –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã:
   - –û–±—â–∞—è –ø—Ä–æ–ª–æ–Ω–≥–∞—Ü–∏—è
   - 1-—è, 2-—è, 3-—è –∞–≤—Ç–æ–ø—Ä–æ–ª–æ–Ω–≥–∞—Ü–∏–∏
4) (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –Ω–æ–≤—ã–π —Ñ–∞–π–ª.
"""

import pandas as pd
import numpy as np

# --- 1. –ß–∏—Ç–∞–µ–º Excel ---------------------------------------------------------
#  üëâ –ó–∞–º–µ–Ω–∏—Ç–µ 'prolongation_data.xlsx' –∏ 'Sheet1' –Ω–∞ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è.
df = pd.read_excel('prolongation_data.xlsx', sheet_name='Sheet1')

# --- 2. –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—è ¬´‚Ä¶ —Å %¬ª ----------------------------------------------
#  –ó–∞–ø–æ–ª–Ω—è–µ–º NaN –Ω—É–ª—è–º–∏, —á—Ç–æ–±—ã —Å–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –¥–∞–ª–æ NaN.
for left, right, new in [
    ('Summ_ClosedBalanceRub',          'Summ_ClosedBalanceRub_int',          'Closed_Total_with_pct'),          # ¬´–≤—Å–µ –∑–∞–∫—Ä—ã—Ç—ã–µ —Å %¬ª
    ('Closed_Sum_NewNoProlong',        'Closed_Sum_NewNoProlong_int',        'Closed_Sum_NewNoProlong_with_pct'),
    ('Closed_Sum_1yProlong_Rub',       'Closed_Sum_1yProlong_Rub_int',       'Closed_Sum_1yProlong_with_pct'),  # 1-—è –∞–≤—Ç–æ–ø—Ä–æ–ª.
    ('Closed_Sum_2yProlong_Rub',       'Closed_Sum_2yProlong_Rub_int',       'Closed_Sum_2yProlong_with_pct'),  # 2-—è –∞–≤—Ç–æ–ø—Ä–æ–ª.
]:
    df[new] = df[left].fillna(0) + df[right].fillna(0)

# --- 3. –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–µ–ª–µ–Ω–∏—è -------------------------------------
def safe_div(num, denom):
    """–î–µ–ª–µ–Ω–∏–µ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç 0 / NaN."""
    return np.where(denom == 0, 0, num / denom)

# --- 4. –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –ø—Ä–æ–ª–æ–Ω–≥–∞—Ü–∏–∏ ----------------------------------
df['–û–±—â–∞—è –ø—Ä–æ–ª–æ–Ω–≥–∞—Ü–∏—è']      = safe_div(df['Opened_Sum_ProlongRub'],  df['Closed_Total_with_pct'])
df['1-—è –∞–≤—Ç–æ–ø—Ä–æ–ª–æ–Ω–≥–∞—Ü–∏—è']    = safe_div(df['Opened_Sum_1yProlong_Rub'], df['Closed_Sum_NewNoProlong_with_pct'])
df['2-—è –∞–≤—Ç–æ–ø—Ä–æ–ª–æ–Ω–≥–∞—Ü–∏—è']    = safe_div(df['Opened_Sum_2yProlong_Rub'], df['Closed_Sum_1yProlong_with_pct'])
df['3-—è –∞–≤—Ç–æ–ø—Ä–æ–ª–æ–Ω–≥–∞—Ü–∏—è']    = safe_div(df['Opened_Sum_3yProlong_Rub'], df['Closed_Sum_2yProlong_with_pct'])

# --- 5. (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç -----------------------------------
# df.to_excel('prolongation_data_enriched.xlsx', index=False)
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–¥**

| –®–∞–≥ | –î–µ–π—Å—Ç–≤–∏–µ | –í—ã—Ö–æ–¥ |
|-----|----------|-------|
| 1   | –ß–∏—Ç–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π Excel –≤ `DataFrame` | `df` |
| 2   | –°–æ–∑–¥–∞—ë—Ç —á–µ—Ç—ã—Ä–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–∫–∏ —Å —É—á—ë—Ç–æ–º –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö % | `Closed_‚Ä¶_with_pct` |
| 3   | –§—É–Ω–∫—Ü–∏—è `safe_div` –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç ¬´–¥–µ–ª–µ–Ω–∏—è –Ω–∞ 0¬ª | ‚Äì |
| 4   | –°—á–∏—Ç–∞–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –ø—Ä–æ–ª–æ–Ω–≥–∞—Ü–∏–∏ (–æ–±—â–µ–µ, 1-—è, 2-—è, 3-—è) | –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è 4 –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ |
| 5   | (–ü–æ –∂–µ–ª–∞–Ω–∏—é) —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–π —Ñ–∞–π–ª | `prolongation_data_enriched.xlsx` |

–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É, –∏–º—è –ª–∏—Å—Ç–∞ –∏ —Å—Ç—Ä–æ–∫—É `to_excel` –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–º–µ–Ω—è–π—Ç–µ –ø–æ–¥ —Å–µ–±—è.
